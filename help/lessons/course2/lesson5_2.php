<?php
B_PROLOG_INCLUDED === true || die();
?>
Двойной сбор $arButtons, которому уделяется внимание в третьем пункте задания, утратил смысл и прекрасно работает в режиме кеширования. Если найдете доказательства, что все-таки требуется выбирать два раза - обязательно их покажите вашем проверяющему.